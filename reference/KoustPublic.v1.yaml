openapi: 3.0.0
info:
  title: Koust Public API v1
  version: '1.0'
  contact:
    name: Koust Support
    url: 'https://koust.net/contact/'
    email: contact@koust.fr
  termsOfService: 'https://koust.net/conditions-generales-de-vente/'
  description: |-
    Use Koust API to create a custom integration with your system.

    To use Koust API, you'll need to:

    - Use the access token ([see details](https://koust.stoplight.io/docs/koust-api-documentation/reference/Authentication.v1.yaml))

    If you have questions, we're available at [contact@koust.fr](mailto:contact@koust.fr) to help.
servers:
  - url: 'https://api.koustapp.com/apex/rest/public_api'
paths:
  /bills:
    parameters: []
    post:
      summary: Get Bills for a period
      operationId: post-bills
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Success_Bills_Model'
              examples:
                Success:
                  value:
                    status: success
                    message: 'Demande d''extraction prise en compte, vos données vont être envoyées à l''url mentionnée.'
                    content:
                      bills_returned: '2'
                      establishment_name: Restau du coin
        '400':
          description: An error occured
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error_Bills_Model'
              examples:
                Error url:
                  value:
                    status: Failed
                    message: Un url de retour doit être mentionnée.
                Error date null:
                  value:
                    status: Failed
                    message: La date de début doit être mentionnée.
                Error format date:
                  value:
                    status: Failed
                    message: La date de fin ne respecte pas le bon format.
                Error start date is more recent:
                  value:
                    status: Failed
                    message: La date de fin doit être supérieur à la date de fin.
                Error content:
                  value:
                    status: Failed
                    message: Veuillez vérifier le contenu de votre requête.
        '401':
          description: Cannot authenticate user
      description: |-
        **Webhook who sends your bills for the chosen dates at the requested url**
        * The Webhook returns the body containing the bills in json format to the URL you requested. You will find the Webhook answer model at the following link : 
          [Weebhook-Model](KoustPublic.v1.yaml/components/schemas/Webhook_Model)
      parameters:
        - schema:
            type: string
          in: header
          name: Content-Type
          description: Resource MIME
        - schema:
            type: string
          in: header
          name: Authorization
          description: Authorization Header
      security:
        - oauth2: []
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Bills-Model'
            examples:
              Example:
                value:
                  url_callback: string
                  date_interval:
                    start_from: YYYY-MM-DD
                    end_at: YYYY-MM-DD
        description: ''
components:
  schemas:
    Bills-Model:
      title: Bills-Model
      type: object
      properties:
        url_callback:
          type: string
        date_interval:
          type: object
          properties:
            start_from:
              type: string
            end_at:
              type: string
    Error_Bills_Model:
      title: Error_Bills_Model
      type: object
      properties:
        status:
          type: string
        message:
          type: string
    Success_Bills_Model:
      title: Success_Bills_Model
      type: object
      properties:
        status:
          type: string
        message:
          type: string
        content:
          type: object
          properties:
            bills_returned:
              type: string
            establishment_name:
              type: string
    Webhook_Model:
      title: Webhook_Model
      type: array
      items:
        type: object
        properties:
          invoice:
            type: string
          invoice_supplier:
            type: object
            properties:
              supplier_id:
                type: string
              supplier_name:
                type: string
          invoice_date:
            type: string
          delivery_date:
            type: string
          deadline_date:
            type: string
          invoice_total:
            type: string
          invoice_items:
            type: array
            items:
              type: object
              properties:
                ingredient_id:
                  type: string
                ingredient_name:
                  type: string
                ingredient_unit:
                  type: string
                ingredient_quantity:
                  type: string
                ingredient_price:
                  type: string
                ingredient_contenance:
                  type: string
                ingredient_contenance_supplier:
                  type: string
                ingredient_conditioning_value:
                  type: string
                ingredient_supplier_retained:
                  type: string
  parameters:
    Content-Type:
      name: Content-Type
      in: header
      required: true
      schema:
        type: string
        default: application/json
      description: Resource MIME
    Authorization:
      name: Authorization
      in: header
      required: true
      schema:
        type: string
        default: ' Bearer YOUR_ACCESS_TOKEN'
      description: Authorization Header
  securitySchemes:
    oauth2:
      type: oauth2
      flows:
        clientCredentials:
          tokenUrl: 'https://auth.koustapp.com/apex/rest/public_authentication/get_access_token'
          scopes: {}
          refreshUrl: 'https://auth.koustapp.com/apex/rest/public_authentication/refresh_token'
